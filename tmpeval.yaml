assistants:
  devstral-2-small-baseline:
    adapter: mistral-vibe
    args:
      model: devstral-small

  devstral-2-small-with-skills:
    adapter: mistral-vibe
    args:
      model: devstral-small
    skills:
        - source: terraform-ibm-modules/terraform-ibm-modules-skills
          skill: terraform-ibm-modules-solution-builder

  devstral-2-baseline:
    adapter: mistral-vibe
    args:
      model: devstral-2

  devstral-2-with-skills:
    adapter: mistral-vibe
    args:
      model: devstral-2
    skills:
        - source: terraform-ibm-modules/terraform-ibm-modules-skills
          skill: terraform-ibm-modules-solution-builder

  claude-haiku-baseline:
    adapter: claude-code
    args:
      model: haiku

  claude-haiku-with-skills:
    adapter: claude-code
    args:
      model: haiku
    skills:
    - source: terraform-ibm-modules/terraform-ibm-modules-skills
      skill: terraform-ibm-modules-solution-builder

tasks:
  # Terraform IBM Modules Solution Builder Skill Evaluation Tasks

  - name: tim-basic-vpc
    prompt: "Create a basic VPC in IBM Cloud using Terraform IBM Modules. The VPC should be named 'test-vpc' and deployed in the us-south region with a single subnet."
    workdir: ./fixtures/empty
    timeout: 300
    assertions:
      - file_exists: "main.tf"
      - file_exists: "variables.tf"
      - file_exists: "outputs.tf"
      - file_exists: "provider.tf"
      - file_exists: "version.tf"
      - file_exists: "README.md"
      - command_succeeds: "terraform init"
      - command_succeeds: "terraform validate"
      - file_contains:
          path: "main.tf"
          pattern: "terraform-ibm-modules"
      - file_contains:
          path: "main.tf"
          pattern: "landing-zone-vpc"

  - name: tim-vpc-with-vsi
    prompt: "Create a Terraform configuration for IBM Cloud that includes a VPC with one subnet and a Virtual Server Instance (VSI) in that subnet. Use Terraform IBM Modules."
    workdir: ./fixtures/empty
    timeout: 360
    assertions:
      - file_exists: "main.tf"
      - file_exists: "variables.tf"
      - file_exists: "outputs.tf"
      - file_exists: "provider.tf"
      - file_exists: "version.tf"
      - file_exists: "README.md"
      - command_succeeds: "terraform init"
      - command_succeeds: "terraform validate"
      - file_contains:
          path: "main.tf"
          pattern: "terraform-ibm-modules"
      - file_contains:
          path: "main.tf"
          pattern: "module\\.vpc"
      - file_contains:
          path: "main.tf"
          pattern: "module\\.vpc\\.vpc_id"

  - name: tim-complete-stack
    prompt: "Create a complete infrastructure stack on IBM Cloud using Terraform IBM Modules that includes: a VPC with 3 subnets across availability zones, a security group with SSH access, and proper outputs for all resources."
    workdir: ./fixtures/empty
    timeout: 420
    assertions:
      - file_exists: "main.tf"
      - file_exists: "variables.tf"
      - file_exists: "outputs.tf"
      - file_exists: "provider.tf"
      - file_exists: "version.tf"
      - file_exists: "README.md"
      - command_succeeds: "terraform init"
      - command_succeeds: "terraform validate"
      - file_contains:
          path: "main.tf"
          pattern: "terraform-ibm-modules"
      - file_contains:
          path: "main.tf"
          pattern: "module\\.vpc"
      - file_contains:
          path: "main.tf"
          pattern: "module\\.security_group"
      - file_contains:
          path: "outputs.tf"
          pattern: "vpc_id"
      - file_contains:
          path: "outputs.tf"
          pattern: "security_group_id"

  - name: tim-module-verification
    prompt: "Create a Terraform configuration using IBM Cloud modules for a VPC. Make sure to verify that the modules you use actually exist in the terraform-ibm-modules namespace before generating the code."
    workdir: ./fixtures/empty
    timeout: 300
    assertions:
      - file_exists: "main.tf"
      - file_exists: "variables.tf"
      - file_exists: "provider.tf"
      - file_exists: "version.tf"
      - command_succeeds: "terraform init"
      - command_succeeds: "terraform validate"
      - file_contains:
          path: "main.tf"
          pattern: "terraform-ibm-modules"
      - file_contains:
          path: "main.tf"
          pattern: "version"
